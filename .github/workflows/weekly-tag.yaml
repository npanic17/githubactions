name: Weekly Development Tag

# 1. TRIGGERI
on:
  # Pokreće se svakog ponedeljka u 03:00 UTC
  schedule:
    - cron: '0 3 * * 1' 
  
  # Dozvoljava ručno pokretanje za testiranje na zahtev
  workflow_dispatch: 

# Dozvole za pisanje nazad u repozitorijum (neophodno za kreiranje taga)
permissions:
  contents: write 

jobs:
  tagging_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # Neophodno za Git komande koje se oslanjaju na istoriju/grane
          fetch-depth: 0 

      # KORAK ZA REŠAVANJE 'Committer identity unknown'
      - name: Configure Git Identity
        run: |
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git config user.name "github-actions[bot]"

      - name: Calculate new Tag Name (sa satom i minutima)
        id: tag_vars
        run: |
          # Generiše datum i vreme u formatu: YYYY_MM_DD_HHMM (npr. 2025_12_15_2330)
          DATE_TIME_PART=$(date +'%Y_%m_%d_%H%M')
          NEW_TAG="weekly_${DATE_TIME_PART}"
          # Postavlja varijablu za korišćenje u sledećim koracima
          echo "NEW_TAG=$NEW_TAG" >> $GITHUB_ENV
          
      - name: Create Annotated Tag
        run: |
          git tag -a $NEW_TAG -m "Nedeljni interni build za $NEW_TAG"

      - name: Push new Tag to GitHub
        run: git push origin $NEW_TAG