name: Weekly Development Tag

# 1. TRIGGERI
on:
  # Pokreće se svakog ponedeljka u 03:00 UTC
  schedule:
    - cron: '0 3 * * 1' 
  
  # Dozvoljava ručno pokretanje za testiranje na zahtev
  workflow_dispatch: 

# Dozvole za pisanje nazad u repozitorijum (neophodno za kreiranje taga)
permissions:
  contents: write 

jobs:
  tagging_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # Neophodno za Git komande koje se oslanjaju na istoriju/grane
          fetch-depth: 0 

      # NOVI KORAK ZA REŠAVANJE 'Committer identity unknown'
      - name: Configure Git Identity
        run: |
          # Postavlja identitet tager-a na zvaničnog GitHub bota
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git config user.name "github-actions[bot]"

      - name: Calculate new Tag Name
        id: tag_vars
        run: |
          # Generiše datum u željenom formatu: YYYY_MM_DD
          DATE_PART=$(date +'%Y_%m_%d')
          NEW_TAG="weekly_${DATE_PART}"
          # Postavlja varijablu za korišćenje u sledećim koracima
          echo "NEW_TAG=$NEW_TAG" >> $GITHUB_ENV
          
      - name: Create Annotated Tag
        # Koristi se varijabla $NEW_TAG iz prethodnog koraka
        run: |
          git tag -a $NEW_TAG -m "Nedeljni interni build za $NEW_TAG"

      - name: Push new Tag to GitHub
        # Šalje samo novokreirani tag na remote
        run: git push origin $NEW_TAG